
{% extends "base.html" %}
{% block title %}{{ topic["title"] }} â€” Forum â€” CampusLink{% endblock %}
{% block content %}
  <div class="d-flex justify-content-between align-items-start gap-3 mb-2">
    <div>
      <h2 class="mb-1">
        {% if topic["pinned"] %}<span class="badge bg-warning text-dark me-1">Pinned</span>{% endif %}
        {{ topic["title"] }}
      </h2>
      <div class="text-muted">{{ topic["author"] }} â€” {{ topic["created_at"] }}</div>
      <div class="text-muted small">
        User: <strong>{{ current_user }}</strong>
        {% if is_admin %}<span class="badge bg-warning text-dark ms-2">Admin</span>{% endif %}
      </div>
    </div>
    <div class="text-end">
      <div class="d-flex gap-2 justify-content-end">
        <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('forum.user_view', next=next_url) }}">User</a>
        <a class="btn btn-sm btn-outline-warning" href="{{ url_for('forum.admin_view', next=next_url) }}">Admin</a>
        <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('forum.list_topics') }}">Back</a>
      </div>
    </div>
  </div>

  <div class="card mb-3">
    <div class="card-body">
      <div style="white-space: pre-wrap;">{{ topic["content"] }}</div>
    </div>
  </div>

  <div class="d-flex align-items-center gap-2 mb-4">
    <div class="text-muted">Likes: <strong>{{ topic["likes"] }}</strong></div>
    <form method="POST" action="/forum/like/{{ topic['id'] }}" class="d-inline">
      <input type="hidden" name="next" value="{{ next_url }}">
      <button class="btn btn-sm btn-outline-primary" type="submit">ğŸ‘ Like</button>
    </form>
    {% if is_admin %}
      <form method="POST" action="/forum/pin/{{ topic['id'] }}" class="d-inline">
        <input type="hidden" name="next" value="{{ next_url }}">
        {% if topic["pinned"] %}
          <button class="btn btn-sm btn-outline-warning" type="submit">Unpin</button>
        {% else %}
          <button class="btn btn-sm btn-outline-warning" type="submit">Pin</button>
        {% endif %}
      </form>
    {% endif %}
  </div>

  <h5 class="mb-3">Replies</h5>
  {% for r in replies %}
    <div class="card mb-2">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-start">
          <strong>{{ r["author"] }}</strong>
          <span class="text-muted small">{{ r["created_at"] }}</span>
        </div>
        <div class="mt-2" style="white-space: pre-wrap;">{{ r["content"] }}</div>
      </div>
    </div>
  {% else %}
    <div class="alert alert-light border">No replies yet.</div>
  {% endfor %}

  <hr class="my-4">
  <h5 class="mb-3">Reply</h5>
  <form method="POST" action="/forum/{{ topic['id'] }}">
    <div class="mb-3">
      <textarea name="content" class="form-control" rows="4" placeholder="Write your reply..." required></textarea>
    </div>
    <button class="btn btn-primary" type="submit">Reply</button>
  </form>
{% endblock %}
